### 什么是索引？

索引是一种能帮助 MySQL 提高查询效率的数据结构

### 索引分别有哪些优点和缺点？

索引的优点如下：

```
- 快速访问数据表中的特定信息，提高检索速度。
- 创建唯一性索引，保证数据表中每一行数据的唯一性。
- 加速表与表之间的连接。
- 使用分组和排序进行数据检索时，可以显著减少查询中分组和排序的时间。


```

索引的缺点：

```
- 虽然提高了的查询速度，但却降低了更新表的速度，比如 update、insert，因为更新数据时，MySQL 不仅要更新数据，还要更新索引文件；
- 建立索引会占用磁盘文件的索引文件。
```

使用索引注意事项：

```
- 使用短索引，短索引不仅可以提高查询速度，更能节省磁盘空间和 I/O 操作；

- 索引列排序，MySQL 查询只使用一个索引，因此如果 where 子句中已经使用了索引的话，那么 order by 中的列是不会使用索引的，因此数据库默认排序可以符合要求的情况下，不要进行排序操作；尽量不要包含多个列的排序，如果需要最好给这些列创建复合索引；

- like 语句操作，一般情况下不鼓励使用 like 操作，如果非使用不可， 注意 like "%aaa%" 不会使用索引，而like "aaa%"可以使用索引；

- 查询的字段或者条件字段可以不与索引字段全部一致，但开头必须一致，且中间不能隔断。例如：abc->abc/ab/a

- 在索引列上做任何操作(计算、 函数、(自动or手动)类型转换)，会导致索引失效而转向全表扫描

  - 	错误的例子：select * from test where id-1=9;

    	 正确的例子：select * from test where id=10;

- 尽量使用覆盖索引（只访问索引的查询（查询列和索引列保持一致）），减少select*

- 当索引出现范围条件后，其后边的索引列将不能被使用

- MySQL在使用不等于(<>或!=)时无法使用索引，会导致全表扫描

- is null和is not null也无法使用索引

- or 也会引起索引失效

- 数据类型错误也会导致索引失效。例如表的字段tu_mdn定义为varchar2(20),但在查询时把该字段作为number类型以where条件传给mysql,这样会导致索引失效.

#### 两表

当使用left join时，左表是驱动表，右表是被驱动表，  右表建索引更好-》因为左连接左表一定会全表扫描的，右表部分扫描

当使用right join时，右表时驱动表，左表是被驱动表，  左表建索引更好-》因为右连接右表一定会全表扫描，左表部分扫描

当使用join时，mysql会选择数据量比较小的表作为驱动表，大表作为被驱动表。  大表使用索引

总结：多表连接时永远是被驱动表的索引起作用

#### 三表

- 小表驱动大表结果集
- 优先优化内存循环
- 保证join语句中被驱动表上join条件字段已经被索引
- 当无法保证被驱动表的join条件字段被索引内存资源充足的前提下，不要太吝啬JoinBuffer的设置


以下 SQL 有什么问题？该如何优化？

select * from t where f/2=100;
该 SQL 会导致引擎放弃索引而全表扫描，尽量避免在索引列上计算。可改为：

select * from t where f=100*2;
```



### 为什么 MySQL 官方建议使用自增主键作为表的主键？

```
索引的物理存储结构：https://blog.csdn.net/qq_37286668/article/details/112176944


mysql (注意本文讲的 mysql 默认为InnoDB 引擎)底层数据结构是 B+ 树，所谓的索引其实就是一颗 B+ 树，一个表有多少个索引就会有多少颗 B+ 树，mysql 中的数据都是按顺序保存在 B+ 树上的(所以说索引本身是有序的)。

然后 mysql 在底层又是以数据页为单位来存储数据的，一个数据页大小默认为 16k，当然你也可以自定义大小，也就是说如果一个数据页存满了，mysql 就会去申请一个新的数据页来存储数据。

如果主键为自增 id 的话，mysql 在写满一个数据页的时候，直接申请另一个新数据页接着写就可以了。

如果主键是非自增 id，为了确保索引有序，mysql 就需要将每次插入的数据都放到合适的位置上。

当往一个快满或已满的数据页中插入数据时，新插入的数据会将数据页写满，mysql 就需要申请新的数据页，并且把上个数据页中的部分数据挪到新的数据页上。

这就造成了页分裂，这个大量移动数据的过程是会严重影响插入效率的。

其实对主键 id 还有一个小小的要求，在满足业务需求的情况下，尽量使用占空间更小的主键 id，因为普通索引的叶子节点上保存的是主键 id 的值，如果主键 id 占空间较大的话，那将会成倍增加 mysql 空间占用大小。
```

```
优点：
- 性能好
- 减少页分裂
缺点：
- 数据量大，可能会超出取值范围
- 分库分表会有问题(一般设定步长，或者自研自增id算法)
 
 
```

### 索引有几种类型？分别如何创建？

MySQL 的索引有两种分类方式：逻辑分类和物理分类。 按照逻辑分类，索引可分为：

- 主键索引：一张表只能有一个主键索引，不允许重复、不允许为 NULL；
- 唯一索引：数据列不允许重复，允许为 NULL 值，一张表可有多个唯一索引，但是一个唯一索引只能包含一列，比如身份证号码、卡号等都可以作为唯一索引；
- 普通索引：一张表可以创建多个普通索引，一个普通索引可以包含多个字段，允许数据重复，允许 NULL 值插入；
- 全文索引：让搜索关键词更高效的一种索引。

按照物理分类，索引可分为：

- 聚集索引：一般是表中的主键索引，如果表中没有显示指定主键，则会选择表中的第一个不允许为 NULL 的唯一索引，如果还是没有的话，就采用 Innodb 存储引擎为每行数据内置的 6 字节 ROWID 作为聚集索引。每张表只有一个聚集索引，因为聚集索引的键值的逻辑顺序决定了表中相应行的物理顺序。聚集索引在精确查找和范围查找方面有良好的性能表现（相比于普通索引和全表扫描），聚集索引就显得弥足珍贵，聚集索引选择还是要慎重的（一般不会让没有语义的自增 id 充当聚集索引）；
- 非聚集索引：该索引中索引的逻辑顺序与磁盘上行的物理存储顺序不同（非主键的那一列），一个表中可以拥有多个非聚集索引。

各种索引的创建脚本如下：

```sql
-- 创建主键索引
alter table t add primary key add (`id`);
-- 创建唯一索引
alter table t add unique (`username`);
-- 创建普通索引
alter table t add index index_name (`username`);
-- 创建全文索引
alter table t add fulltext (`username`);
```



### 主索引和唯一索引有什么区别？

- 主索引不能重复且不能为空，唯一索引不能重复，但可以为空；
- 一张表只能有一个主索引，但可以有多个唯一索引；
- 主索引的查询性能要高于唯一索引。

### 什么叫回表查询？

普通索引查询到主键索引后，回到主键索引树搜索的过程，我们称为回表查询。

```
因为普通索引的查询会多执行一次检索操作。比如主键查询 select * from t where id=10 只需要搜索 id 的这棵 B+ 树，而普通索引查询 select * from t where f=3 会先查询 f 索引树，得到 id 的值之后再去搜索 id 的 B+ 树，因为多执行了一次检索，所以执行效率就比主键索引要低。
```



### 如何查询一张表的所有索引？

`SHOW INDEX FROM T` 查询表 T 所有索引。



### MySQL 最多可以创建多少个索引列？

MySQL 中最多可以创建 16 个索引列。



### 如何让 like %abc 走索引查询？

我们知道如果要让 like 查询要走索引，查询字符不能以通配符（%）开始，如果要让 like %abc 也走索引，可以使用 REVERSE() 函数来创建一个函数索引，查询脚本如下：

> select * from t where reverse(f) like reverse('%abc');

### MySQL 联合索引应该注意什么？

联合索引又叫复合索引，MySQL 中的联合索引，遵循最左匹配原则，比如，联合索引为 key(a,b,c)，则能触发索引的搜索组合是 a|ab|abc 这三种查询。



### 联合索引的作用是什么？

联合索引的作用如下：

- 用于多字段查询，比如，建了一个 key(a,b,c) 的联合索引，那么实际等于建了 key(a)、key(a,b)、key(a,b,c) 等三个索引，我们知道，每多一个索引，就会多一些写操作和占用磁盘空间的开销，尤其是对大数据量的表来说，这可以减少一部分不必要的开销；
- 覆盖索引，比如，对于联合索引 key(a,b,c) 来说，如果使用 SQL：`select a,b,c from table where a=1 and b = 1` ，就可以直接通过遍历索引取得数据，而无需回表查询，这就减少了随机的 IO 操作，减少随机的 IO 操作，可以有效的提升数据库查询的性能，是非常重要的数据库优化手段之一；
- 索引列越多，通过索引筛选出的数据越少。

### 什么是最左匹配原则？它的生效原则有哪些？

最左匹配原则也叫最左前缀原则，是 MySQL 中的一个重要原则，说的是索引以最左边的为起点任何连续的索引都能匹配上，当遇到范围查询（>、<、between、like）就会停止匹配。 生效原则来看以下示例，比如表中有一个联合索引字段 index(a,b,c)：

- where a=1 只使用了索引 a；
- where a=1 and b=2 只使用了索引 a,b；
- where a=1 and b=2 and c=3 使用a,b,c；
- where b=1 or where c=1 不使用索引；
- where a=1 and c=3 只使用了索引 a；
- where a=3 and b like 'xx%' and c=3 只使用了索引 a,b。

### 以下语句会走索引么？

```sql
select * from t where year(date)>2018;

```

不会，因为在索引列上涉及到了运算。



### 能否给手机号的前 6 位创建索引？如何创建？

可以，创建方式有两种：

- alter table t add index index_phone(phone(6));
- create index index_phone on t(phone(6));

### 什么是前缀索引？

前缀索引也叫局部索引，比如给身份证的前 10 位添加索引，类似这种给某列部分信息添加索引的方式叫做前缀索引。

### 为什么要用前缀索引？

前缀索引能有效减小索引文件的大小，让每个索引页可以保存更多的索引值，从而提高了索引查询的速度。但前缀索引也有它的缺点，不能在 order by 或者 group by 中触发前缀索引，也不能把它们用于覆盖索引。